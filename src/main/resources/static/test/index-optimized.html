<!DOCTYPE html>
<html lang="zh">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>å¿«é€Ÿè·³è½¬æµ‹è¯• - ä¼˜åŒ–ç‰ˆ</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 20px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        min-height: 100vh;
      }
      .container {
        max-width: 800px;
        margin: 0 auto;
        background: rgba(255, 255, 255, 0.1);
        padding: 30px;
        border-radius: 15px;
        backdrop-filter: blur(10px);
      }
      .status {
        background: rgba(0, 0, 0, 0.3);
        padding: 15px;
        border-radius: 8px;
        margin: 10px 0;
        font-family: monospace;
      }
      .success {
        color: #4ade80;
      }
      .warning {
        color: #fbbf24;
      }
      .error {
        color: #f87171;
      }
      .info {
        color: #60a5fa;
      }
      .timer {
        font-size: 2em;
        text-align: center;
        margin: 20px 0;
        font-weight: bold;
      }
      .progress-bar {
        width: 100%;
        height: 20px;
        background: rgba(255, 255, 255, 0.2);
        border-radius: 10px;
        overflow: hidden;
        margin: 10px 0;
      }
      .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, #4ade80, #22c55e);
        width: 0%;
        transition: width 0.3s ease;
      }
      .stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin: 20px 0;
      }
      .stat-card {
        background: rgba(255, 255, 255, 0.1);
        padding: 15px;
        border-radius: 8px;
        text-align: center;
      }
      .stat-value {
        font-size: 1.5em;
        font-weight: bold;
        color: #4ade80;
      }
      .stat-label {
        font-size: 0.9em;
        opacity: 0.8;
      }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mobile-detect/1.4.5/mobile-detect.min.js"></script>
  </head>
  <body>
    <div class="container">
      <h1>ğŸš€ å¿«é€Ÿè·³è½¬æµ‹è¯• - ä¼˜åŒ–ç‰ˆ</h1>
      <p>è¿™ä¸ªé¡µé¢æ¼”ç¤ºäº†ä¼˜åŒ–çš„å¿«é€Ÿè·³è½¬å’Œå¼‚æ­¥è®°å½•åŠŸèƒ½</p>

      <div class="timer" id="timer">0.00ms</div>
      <div class="progress-bar">
        <div class="progress-fill" id="progress"></div>
      </div>

      <div class="stats">
        <div class="stat-card">
          <div class="stat-value" id="jumpTime">-</div>
          <div class="stat-label">è·³è½¬è€—æ—¶</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="sendTime">-</div>
          <div class="stat-label">å‘é€è€—æ—¶</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="totalTime">-</div>
          <div class="stat-label">æ€»è€—æ—¶</div>
        </div>
      </div>

      <div id="status" class="status">
        <div class="info">â³ æ­£åœ¨åˆå§‹åŒ–...</div>
      </div>

      <button
        onclick="testJump()"
        style="
          background: #4ade80;
          color: white;
          border: none;
          padding: 15px 30px;
          border-radius: 8px;
          font-size: 16px;
          cursor: pointer;
          margin: 10px 5px;
        "
      >
        ğŸš€ æµ‹è¯•å¿«é€Ÿè·³è½¬
      </button>

      <button
        onclick="testNormal()"
        style="
          background: #fbbf24;
          color: white;
          border: none;
          padding: 15px 30px;
          border-radius: 8px;
          font-size: 16px;
          cursor: pointer;
          margin: 10px 5px;
        "
      >
        ğŸŒ æµ‹è¯•æ™®é€šè·³è½¬
      </button>
    </div>

    <script>
      let startTime, jumpTime, sendTime, totalTime;
      let progressInterval;

      function updateStatus(message, type = "info") {
        const status = document.getElementById("status");
        const className =
          type === "success"
            ? "success"
            : type === "warning"
            ? "warning"
            : type === "error"
            ? "error"
            : "info";
        status.innerHTML += `<div class="${className}">${message}</div>`;
        status.scrollTop = status.scrollHeight;
      }

      function updateProgress(percent) {
        document.getElementById("progress").style.width = percent + "%";
      }

      function updateTimer() {
        if (startTime) {
          const elapsed = performance.now() - startTime;
          document.getElementById("timer").textContent =
            elapsed.toFixed(2) + "ms";
        }
      }

      function generateSessionId() {
        return (
          "test_" + Date.now() + "_" + Math.random().toString(36).substr(2, 9)
        );
      }

      function collectDeviceInfo() {
        const md = new MobileDetect(window.navigator.userAgent);
        const urlParams = new URLSearchParams(window.location.search);
        const hasQueryParams = urlParams.toString() !== "";

        const deviceType = md.mobile() ? "Mobile" : "PC";
        const isMobile = md.mobile() !== null || md.tablet() !== null;
        const isIOS = md.is("iOS")
          ? "iOS"
          : md.is("AndroidOS")
          ? "Android"
          : "Other";
        const userAgent = navigator.userAgent;
        const screenWidth = window.screen.width;
        const screenHeight = window.screen.height;
        const pixelRatio = window.devicePixelRatio;
        const timezoneName = Intl.DateTimeFormat().resolvedOptions().timeZone;
        const continent = timezoneName.split("/")[0];
        const userLanguage = navigator.language || navigator.userLanguage;

        let codefb = "";
        if (urlParams.get("utm_source") === "fb" && urlParams.has("fbclid")) {
          codefb = "Facebookå¹¿å‘Šè®¿é—®çš„ã€‚";
        } else if (urlParams.has("fbclid")) {
          codefb = "Facebooké“¾æ¥è®¿é—®çš„ã€‚";
        } else if (urlParams.get("utm_source") === "fb") {
          codefb = "Facebookå¹¿å‘Šè®¿é—®çš„ã€‚";
        } else if (urlParams.has("ttclid")) {
          codefb = "TikToké“¾æ¥è®¿é—®çš„ã€‚";
        } else {
          codefb = "ä¸æ˜¯Facebookæˆ–TikTok";
        }

        return {
          domainName: window.location.host + window.location.pathname,
          userIp: "127.0.0.1", // æµ‹è¯•ç”¨
          userMobile: deviceType,
          paraPath: hasQueryParams,
          isIOSS: isIOS,
          fb: codefb,
          screenWidth: screenWidth,
          screenHeight: screenHeight,
          pixelRatio: pixelRatio,
          continent: continent,
          userLanguage: userLanguage,
          userAgent: userAgent,
          isMobile: isMobile,
          timestamp: new Date().toISOString(),
          sessionId: generateSessionId(),
        };
      }

      async function testJump() {
        startTime = performance.now();
        updateStatus("ğŸš€ å¼€å§‹å¿«é€Ÿè·³è½¬æµ‹è¯•...", "info");
        updateProgress(10);

        // æ”¶é›†è®¾å¤‡ä¿¡æ¯
        const data = collectDeviceInfo();
        updateProgress(30);
        updateStatus("ğŸ“± è®¾å¤‡ä¿¡æ¯æ”¶é›†å®Œæˆ", "success");

        // ç«‹å³è·³è½¬ï¼ˆä¸ç­‰å¾…ä»»ä½•å“åº”ï¼‰
        const jumpStart = performance.now();
        updateStatus("âš¡ ç«‹å³è·³è½¬ï¼Œä¸ç­‰å¾…å“åº”...", "warning");
        updateProgress(50);

        // æ¨¡æ‹Ÿè·³è½¬ï¼ˆå®é™…æµ‹è¯•æ—¶æ›¿æ¢ä¸ºçœŸå®è·³è½¬ï¼‰
        setTimeout(() => {
          jumpTime = performance.now() - jumpStart;
          updateStatus(
            `âœ… è·³è½¬å®Œæˆï¼Œè€—æ—¶: ${jumpTime.toFixed(2)}ms`,
            "success"
          );
          updateProgress(70);

          // å¼‚æ­¥å‘é€æ•°æ®
          const sendStart = performance.now();
          updateStatus("ğŸ“¤ å¼€å§‹å¼‚æ­¥å‘é€æ•°æ®...", "info");

          if (navigator.sendBeacon) {
            const blob = new Blob([JSON.stringify(data)], {
              type: "application/json",
            });
            const success = navigator.sendBeacon(
              "https://xunocl.world/fbVpnStock/quickRecord",
              blob
            );
            sendTime = performance.now() - sendStart;
            updateStatus(
              `ğŸ“¤ sendBeaconå‘é€å®Œæˆï¼Œè€—æ—¶: ${sendTime.toFixed(
                2
              )}msï¼ŒçŠ¶æ€: ${success}`,
              "success"
            );
          } else {
            fetch("https://xunocl.world/fbVpnStock/quickRecord", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify(data),
              signal: AbortSignal.timeout(2000),
            })
              .then(() => {
                sendTime = performance.now() - sendStart;
                updateStatus(
                  `ğŸ“¤ fetchå‘é€å®Œæˆï¼Œè€—æ—¶: ${sendTime.toFixed(2)}ms`,
                  "success"
                );
              })
              .catch((error) => {
                sendTime = performance.now() - sendStart;
                updateStatus(
                  `âŒ å‘é€å¤±è´¥ï¼Œè€—æ—¶: ${sendTime.toFixed(2)}msï¼Œé”™è¯¯: ${
                    error.message
                  }`,
                  "error"
                );
              });
          }

          updateProgress(100);
          totalTime = performance.now() - startTime;

          // æ›´æ–°ç»Ÿè®¡
          document.getElementById("jumpTime").textContent =
            jumpTime.toFixed(2) + "ms";
          document.getElementById("sendTime").textContent =
            sendTime.toFixed(2) + "ms";
          document.getElementById("totalTime").textContent =
            totalTime.toFixed(2) + "ms";

          updateStatus(
            `ğŸ‰ æµ‹è¯•å®Œæˆï¼æ€»è€—æ—¶: ${totalTime.toFixed(2)}ms`,
            "success"
          );
          updateStatus(
            "ğŸ’¡ æ³¨æ„ï¼šè·³è½¬æ˜¯ç«‹å³æ‰§è¡Œçš„ï¼Œæ•°æ®å‘é€æ˜¯å¼‚æ­¥çš„ï¼Œä¸å½±å“ç”¨æˆ·ä½“éªŒ",
            "info"
          );
        }, 100); // æ¨¡æ‹Ÿè·³è½¬å»¶è¿Ÿ
      }

      async function testNormal() {
        startTime = performance.now();
        updateStatus("ğŸŒ å¼€å§‹æ™®é€šè·³è½¬æµ‹è¯•ï¼ˆç­‰å¾…å“åº”ï¼‰...", "info");
        updateProgress(10);

        const data = collectDeviceInfo();
        updateProgress(30);

        // ç­‰å¾…å“åº”åå†è·³è½¬
        const sendStart = performance.now();
        updateStatus("â³ ç­‰å¾…æœåŠ¡å™¨å“åº”...", "warning");

        try {
          const response = await fetch(
            "https://xunocl.world/fbVpnStock/protectLink",
            {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify(data),
            }
          );

          sendTime = performance.now() - sendStart;
          updateStatus(
            `ğŸ“¤ æœåŠ¡å™¨å“åº”å®Œæˆï¼Œè€—æ—¶: ${sendTime.toFixed(2)}ms`,
            "success"
          );
          updateProgress(70);

          // æ”¶åˆ°å“åº”åæ‰è·³è½¬
          const jumpStart = performance.now();
          updateStatus("âš¡ æ”¶åˆ°å“åº”åå¼€å§‹è·³è½¬...", "info");

          setTimeout(() => {
            jumpTime = performance.now() - jumpStart;
            updateProgress(100);
            totalTime = performance.now() - startTime;

            document.getElementById("jumpTime").textContent =
              jumpTime.toFixed(2) + "ms";
            document.getElementById("sendTime").textContent =
              sendTime.toFixed(2) + "ms";
            document.getElementById("totalTime").textContent =
              totalTime.toFixed(2) + "ms";

            updateStatus(
              `âœ… æ™®é€šè·³è½¬å®Œæˆï¼æ€»è€—æ—¶: ${totalTime.toFixed(2)}ms`,
              "success"
            );
            updateStatus("âš ï¸ æ³¨æ„ï¼šç”¨æˆ·éœ€è¦ç­‰å¾…æœåŠ¡å™¨å“åº”æ‰èƒ½è·³è½¬", "warning");
          }, 100);
        } catch (error) {
          updateStatus(`âŒ æ™®é€šè·³è½¬å¤±è´¥: ${error.message}`, "error");
        }
      }

      // å¯åŠ¨å®šæ—¶å™¨
      setInterval(updateTimer, 16); // 60fps

      // é¡µé¢åŠ è½½å®Œæˆ
      updateStatus("âœ… é¡µé¢åŠ è½½å®Œæˆï¼Œå¯ä»¥å¼€å§‹æµ‹è¯•", "success");
    </script>
  </body>
</html>
